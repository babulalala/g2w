#!/bin/bash
#
# Script: install
# Description: install script for g2w
# Version: 4.0.7
# Date: 2016.08.01
#

bin_folder=/usr/local/bin

set_alias_centos() {
	local login_script_name=g2w.sh
	local login_shell_folder=/etc/profile.d
	local login_script=./$login_script_name

	if [ -f $login_script ];then
		echo -n "copy $login_script to $login_shell_folder ... "
		cp $login_script $login_shell_folder

		if [ $? -eq 0 ];then
			echo ok
		else
			echo error
		fi
	else
		echo "can't find $login_script"
	fi
}

set_alias_cygwin() {
	local login_script_name=bash.bashrc
	local login_shell_folder=/etc
	local login_script=$login_shell_folder/$login_script_name

	local cmd1='alias sw="source sw"'
	local cmd2='alias gw="source gw"'

	local cmd=

	if [ -r $login_script ];then
		grep $cmd1 $login_script 1>/dev/null 2>&1
		
		if [ ! $? -eq 0 ];then
			echo -n "add $cmd1 to $login_script"
			echo $cmd1 >> $login_script
			if [ $? -eq 0 ];then
				echo ok
			else
				echo error
			fi
		fi

		grep $cmd2 $login_script 1>/dev/null 2>&1

		if [ ! $? -eq 0 ];then
			echo -n "add $cmd2 to $login_script"
			echo $cmd2 >> $login_script
			if [ $? -eq 0 ];then
				echo ok
			else
				echo error
			fi
		fi

	else
		echo 'alias sw="source sw"' >> $login_script
		echo 'gw="source gw"' >> $login_script
	fi
}

set_alias() {
	echo -n "checking OS .... "

	local os=`uname -o`

	echo $os

	case "$os" in
		"Cygwin") 
			set_alias_cygwin
		;;
		"GNU/Linux") set_alias_centos
		;;
		*) echo "Sorry, we don't support your system now."
		   exit 0
		;;
	esac
}	

show_messages() {
	cat <<here

Please re-login the terminal to affect the functions.
here

}

#
main() {
echo -n "check source (not finish yet) .... "
echo ok

#
echo -n "copy gw to $bin_folder .... "
cp -f gw $bin_folder

if [ $? -eq 0 ];then
	echo ok
else
	echo error
fi

#
echo -n copy sw to $bin_folder ....
cp -f sw $bin_folder

if [ $? -eq 0 ];then
	echo ok
else
	echo error
fi

	# set alias
	set_alias

	# show messasges
	show_messages

}

# main #
main

## End of Script ##
